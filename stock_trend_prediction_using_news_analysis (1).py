# -*- coding: utf-8 -*-
"""stock trend prediction using news analysis.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1si7NhwOxxGfIMWQbjAUtbJyApgcr2wb9
"""

!pip install nltk pandas

import pandas as pd
import nltk
from nltk.corpus import stopwords
from sklearn.model_selection import train_test_split
from sklearn.naive_bayes import GaussianNB, MultinomialNB, BernoulliNB
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.metrics import accuracy_score
import re

#load file
from google.colab import files
files.upload()

# Load your dataset
# Replace 'your_dataset.csv' with the actual path to your CSV file
df = pd.read_csv('News.csv', encoding='utf-8')
df.head(10)

df.shape

df['combined'] = df['Title'] + ' ' + df['News']

import nltk
# Download the Bengali stop words
nltk.download('stopwords')

nltk.download('punkt')

import pandas as pd
import nltk
import string
from nltk.corpus import stopwords

#load file stopword
from google.colab import files
files.upload()

# Load your dataset
# Replace 'your_dataset.csv' with the actual path to your CSV file
nf = pd.read_csv('stopword.csv', encoding='utf-8')
nf.head(20)

nf.shape

stopwords_df = pd.read_csv('stopword.csv')
bangla_stopwords = set(stopwords_df['stopword'].tolist())

df = df.dropna()

# Example: Preprocessing function (customize it as per your requirement)
#bangla symborl
def clean_sym(text):
  pattern = r'[\r\n—?,;।!‘"’\.:\(\)\[\]…0-9<*>]'
  text = re.sub(pattern,'', text)
  return text
# lower the cases
def lower_cases(text):
 return text.lower()
# remove special characters
def remove_char(text):
 pattern = r'[^a-zA-z0–9\s]'
 text = re.sub(pattern,'', text)
 return text
#remove eng word
def remove_eng(text):
  pattern = r'[a-zA-z0–9\s]'
  text = re.sub(pattern,'', text)
  return text
def preprocess(text):
    # Convert to lowercase
    text = text.lower()

    # Remove punctuation
    text = text.translate(str.maketrans('', '', string.punctuation))

    # Tokenize text
    words = nltk.word_tokenize(text)

    # Remove stopwords
    words = [word for word in words if word not in bangla_stopwords]

    # Join words back to text
    text = ' '.join(words)

    return text

df['processed'] = df['combined'].apply(preprocess)
df['processed'] = df['combined'].apply(clean_sym)
df['processed'] = df['combined'].apply(remove_eng)

vectorizer = CountVectorizer()
X = vectorizer.fit_transform(df['processed'])
y = df['Labeling']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

gaussian_model = GaussianNB()
multinomial_model = MultinomialNB()
bernoulli_model = BernoulliNB()

# Fit models
gaussian_model.fit(X_train.toarray(), y_train)
multinomial_model.fit(X_train, y_train)
bernoulli_model.fit(X_train, y_train)

y_pred_gaussian = gaussian_model.predict(X_test.toarray())
y_pred_multinomial = multinomial_model.predict(X_test)
y_pred_bernoulli = bernoulli_model.predict(X_test)

def predict_sentiment(title, news):
    combined_text = title + ' ' + news
    processed_text = preprocess(combined_text)

    # Vectorizing the text (use the same vectorizer object you created during training)
    vectorized_text = vectorizer.transform([processed_text])

    # Predict using the trained models
    pred_gaussian = gaussian_model.predict(vectorized_text.toarray())
    pred_multinomial = multinomial_model.predict(vectorized_text)
    pred_bernoulli = bernoulli_model.predict(vectorized_text)

    return pred_gaussian[0], pred_multinomial[0], pred_bernoulli[0]

new_title = "তৃনমূল নারী উদ্যোক্তা সোসাইটি (গ্রাসরুটস) এর উদ্যোগে সিলেটে বিজয় দিবস উপলক্ষে দিনব্যাপী কর্মসূচীতে এবি ব্যাংক পি এল সি নারী উদ্যোক্তাদের প্রশিক্ষন শেষে তাদের মাঝে ঋণ বিতরণ করে"
new_news = "দেশের বেসরকারি খাতের দি সিটি ব্যাংক তাদের অনুমোদিত (অথরাইজড) মূলধন বাড়াচ্ছে। ব্যাংকটি তাদের বর্তমান অনুমোদিত মূলধন দেড় হাজার কোটি থেকে বাড়িয়ে দুই হাজার কোটি টাকা করার সিদ্ধান্ত নিয়েছে। গতকাল বুধবার শেয়ারবাজারে তালিকাভুক্ত ব্যাংকটি দেশের দুই স্টক এক্সচেঞ্জের মাধ্যমে বিনিয়োগকারীদের এ তথ্য জানিয়েছে। মূলধন বাড়ানোর বিষয়টি বেশ সময়সাপেক্ষ। এ জন্য নিয়ন্ত্রক সংস্থা ও শেয়ারধারীদের অনুমোদন নিতে হয়। সামনে যেহেতু আমাদের এজিএম রয়েছে, তাই আমরা আগেভাগে অনুমোদিত মূলধন বাড়ানোর কাজটি সম্পন্ন করার সিদ্ধান্ত নিয়েছি,মাসরুর আরেফিন, ব্যবস্থাপনা পরিচালক, দি সিটি ব্যাংক । দেশের প্রধান শেয়ারবাজার ঢাকা স্টক এক্সচেঞ্জের (ডিএসই) দেওয়া ঘোষণা অনুযায়ী, ব্যাংকটির অনুমোদিত মূলধন ৫০০ কোটি টাকা বাড়ানো হবে। বাংলাদেশ ব্যাংক ও শেয়ারধারীদের অনুমোদনের পর এ মূলধন বাড়ানোর সিদ্ধান্ত কার্যকর হবে।মূলধন বাড়ানোর সিদ্ধান্তের বিষয়ে জানতে চাইলে দি সিটি ব্যাংকের ব্যবস্থাপনা পরিচালক মাসরুর আরেফিন প্রথম আলোকে বলেন, ‘আমাদের ব্যাংকের পরিশোধিত মূলধন বাড়ছে। ইতিমধ্যে ব্যাংকের পরিশোধিত মূলধন ১ হাজার ২০০ কোটি টাকায় উন্নীত হয়েছে। সর্বশেষ ২০২২ সালের জন্য আমরা ২ শতাংশ বোনাস লভ্যাংশ ঘোষণা করেছি। বার্ষিক সাধারণ সভায় (এজিএম) অনুমোদনের পর এ লভ্যাংশ কার্যকর করা হলে তাতে পরিশোধিত মূলধন আরও ২৪ কোটি টাকা বেড়ে যাবে। এর বাইরে আমরা নতুন করে বিদেশি ইকুইটি (মূলধন) বিনিয়োগ আনারও চেষ্টা করছি। যদি বিদেশি বিনিয়োগ চলে আসে, তাতে পরিশোধিত মূলধন আরও বেড়ে যাবে। যেকোনো কোম্পানির বা ব্যাংকের পরিশোধিত মূলধন বলতে সেই মূলধনকে বোঝায়, যা ওই ব্যাংকের বা কোম্পানির শেয়ারধারীদের সরাসরি বিনিয়োগের অংশ। আর অনুমোদিত মূলধন বলতে বোঝায় ওই কোম্পানি বা ব্যাংকের যে পরিমাণ শেয়ার বিক্রির আইনগত অধিকার রয়েছে। মাসরুর আরেফিন আরও বলেন, ‘মূলধন বাড়ানোর বিষয়টি বেশ সময়সাপেক্ষ। এ জন্য নিয়ন্ত্রক সংস্থা ও শেয়ারধারীদের অনুমোদন নিতে হয়। সামনে যেহেতু আমাদের এজিএম রয়েছে, তাই আমরা আগেভাগে অনুমোদিত মূলধন বাড়ানোর কাজটি সম্পন্ন করার সিদ্ধান্ত নিয়েছি, যাতে ভবিষ্যতে পরিশোধিত মূলধন বাড়ানোর কাজটি সহজে করা যায়। ব্যাংক ও আর্থিক খাতের জন্য আন্তর্জাতিক রীতিনীতিতে এখন যেকোনো ব্যাংকের মূলধনকাঠামো শক্তিশালী করার ওপর জোর দেওয়া হচ্ছে। কারণ, যে ব্যাংকের মূলধন যত বেশি শক্তিশালী, সেই ব্যাংকের আর্থিক ভিত্তি তত মজবুত থাকে। যেকোনো কোম্পানির বা ব্যাংকের পরিশোধিত মূলধন বলতে সেই মূলধনকে বোঝায়, যা ওই ব্যাংকের বা কোম্পানির শেয়ারধারীদের সরাসরি বিনিয়োগের অংশ। আর অনুমোদিত মূলধন বলতে বোঝায় ওই কোম্পানি বা ব্যাংকের যে পরিমাণ শেয়ার বিক্রির আইনগত অধিকার রয়েছে। উদাহরণ হিসেবে ধরা যাক, কোনো ব্যাংকের পরিশোধিত মূলধন এক হাজার কোটি টাকা। আর অনুমোদিত মূলধন দেড় হাজার কোটি টাকা। তার মানে, ওই ব্যাংকে শেয়ারধারীদের মূলধন বিনিয়োগের পরিমাণ এক হাজার কোটি টাকা। আর দেড় হাজার কোটি টাকা অনুমোদিত মূলধন মানে ব্যাংকটি ভবিষ্যতে নতুন করে আরও ৫০০ কোটি টাকার সমমূল্যের শেয়ার ইস্যু করতে পারবে, যার অনুমোদন অনুমোদিত মূলধনের মাধ্যমে আগেই নেওয়া হয়েছে। ব্যাংক ও আর্থিক খাতের জন্য আন্তর্জাতিক রীতিনীতিতে এখন যেকোনো ব্যাংকের মূলধনকাঠামো শক্তিশালী করার ওপর জোর দেওয়া হচ্ছে। কারণ, যে ব্যাংকের মূলধন যত বেশি শক্তিশালী, সেই ব্যাংকের আর্থিক ভিত্তি তত মজবুত থাকে। এ বিষয়ে মাসরুর আরেফিন বলেন, ‘আমাদের উদ্যোক্তা ও শেয়ারধারীরা ব্যাংকের মূলধন বাড়ানোর বিষয়ে বেশ আগ্রহী। কারণ, তাঁরা বিশ্বাস করেন, আর্থিক ভিত্তি যত বেশি মজবুত হবে, ঋণ বিতরণসহ ব্যাংকের সামগ্রিক কার্যক্রম তত বেশি গতিশীল হবে। এ কারণে উদ্যোক্তা ও শেয়ারধারীরা কম মুনাফা বা লভ্যাংশ নিয়ে হলেও মূলধন শক্তিশালী করার প্রতি বেশি মনোযোগী।"

sentiment_gaussian, sentiment_multinomial, sentiment_bernoulli = predict_sentiment(new_title, new_news)

print(f"GaussianNB Sentiment: {sentiment_gaussian}")
print(f"MultinomialNB Sentiment: {sentiment_multinomial}")
print(f"BernoulliNB Sentiment: {sentiment_bernoulli}")